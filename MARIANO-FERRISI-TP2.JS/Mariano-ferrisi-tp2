
// Consigna TP 2

/* Realizar una class que tenga el nombre de "contenedor" que reciba el nombre de un archivo a crear y tenga los siguientes metodos */

//Metodos a incluir 
/* 
save(object): recibe un objeto y devuelve un number
getById(number): object -recibe un ID y devuelve el objeto que tenga ese ID (else: null)
getAll(): object[] Devuelve un array con todos los objetos del archivo
deleteById(number): Elimina del archivo el objeto con el id buscado
deleteAll(): Elimina todos objetos presentes en el archivo
*/
/* El método save incorporará al producto un id numérico, que deberá ser siempre uno más que el id del último objeto agregado (o id 1 si es el primer objeto que se agrega) y no puede estar repetido.
Tomar en consideración el contenido previo del archivo, en caso de utilizar uno existente.
Implementar el manejo de archivos con el módulo fs de node.js, utilizando promesas con async/await y manejo de errores.
Probar el módulo creando un contenedor de productos, que se guarde en el archivo: “productos.txt”
Incluir un llamado de prueba a cada método, y mostrando por pantalla según corresponda para verificar el correcto funcionamiento del módulo construído. 
 */

const fs = require("fs");

//Funciones asincronicas de guardado que no funcionan

const saveArchive = async (rute, content) =>{
    try{
        await fs.promises.writeFile(rute, JSON.stringify(content));
        console.log("NICE: El archivo se guardo correctamente")
    }
    catch(err){
        console.log("ERROR: No se pudo crear el archivo");
    }
};

const saveArchiveProPlus = (rute, content)=>{
    fs.writeFile(rute, JSON.stringify(content), err=>{
        err ? console.log("no se guardo el archivo :(") : console.log("archivo guardado exitosamente :)")
    });
}

//Funcion sincronica de guardado pero sin manejo de errores

const saveArchivePro = (rute, content) =>{
    fs.writeFileSync(rute, JSON.stringify(content))
}


class Product{
    constructor(title, price, thumbnail){
        this.title = title,
        this.price = price,
        this.thumbnail = thumbnail
    }
};
class Contenedor{
    constructor (){
        this.content = [];
        this.counter = 0;
    }
    save(object){
        this.counter ++;
        object.id = this.counter;
        this.content.push(object);
        saveArchivePro("productos.txt", this.content)
        return "el producto se guardo con el ID " + this.counter;
    }
    getById(id){
        let filterResult = this.content.filter(content => content.id === id);

        return filterResult.length === 1 ? filterResult = filterResult :  filterResult = null;
    }
    deleteById(id){
        this.content = this.content.filter(content => content.id !== id);
        saveArchivePro("./productos.txt", this.content)
        return this.content;
    }
    getAll(){
        return this.content;
    }
    deleteAll(){
        this.content = [];
        saveArchivePro("./productos.txt", this.content);
        return this.content;
    }
};
const contenedor = new Contenedor();

contenedor.save(new Product("Smart TV Samsung 48'", 90000, "http://medias.musimundo.com/medias/00436004-144198-144198-01-144198-01.jpg-size515?context=bWFzdGVyfGltYWdlc3w1NDIxMnxpbWFnZS9qcGVnfGhhZS9oODgvMTAzODA5MDM3NDM1MTgvMDA0MzYwMDQtMTQ0MTk4LTE0NDE5OF8wMS0xNDQxOThfMDEuanBnX3NpemU1MTV8NmEzYTY3OTQ5M2RjMjU0ODNlOGU5ZTRkN2FmMTZhODA1NjNkOTc3ZmYxMjljNjU4NmIxMTVjMmIzYzUwYTU4ZQ"));
contenedor.save(new Product("Samsung S20", 120000, "http://medias.musimundo.com/medias/00367049-142840-142840-01-142840-01.jpg-size515?context=bWFzdGVyfGltYWdlc3w3NzIxNHxpbWFnZS9qcGVnfGgzNi9oZDgvMTAzODA0NzA1MTc3OTAvMDAzNjcwNDktMTQyODQwLTE0Mjg0MF8wMS0xNDI4NDBfMDEuanBnX3NpemU1MTV8N2ZhYzc3NDBiYmM0NjNjNWNmNWIxYmFkN2IwYmE0NGQ1YWY1ZTNiYWE5MTY2NjY4YjZhYmMxZTBhNDQ1MzY0ZQ"));
contenedor.save(new Product("Samsung S10", 80000, "https://zelucashdev.s3.sa-east-1.amazonaws.com/uploads/telefono/modelo/Galaxy%20S/Galaxy%20S10/S10/S10_Black_Front_800.png"));

contenedor.deleteById(2);
console.log(contenedor);
console.log(contenedor.getById(8));
console.log(contenedor.getById(3));
contenedor.deleteAll();